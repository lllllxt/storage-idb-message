!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).StorageIdbMessage=e()}(this,function(){"use strict";function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function t(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(t,e,n){return t(n={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&n.path)}},n.exports),n.exports}function o(t){return t&&t.Math==Math&&t}function i(t){try{return!!t()}catch(t){return!0}}function c(t){return"object"==typeof t?null!==t:"function"==typeof t}function u(t){return b?m.createElement(t):{}}function h(t){if(!c(t))throw TypeError(String(t)+" is not an object");return t}function f(t,e){if(!c(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!c(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!c(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!c(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}function s(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}function l(e,n){try{O(y,e,n)}catch(t){y[e]=n}return n}function p(t,e){return _.call(t,e)}function d(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++D+x).toString(36)}function v(t){return p(k,t)||(P&&p(M,t)?k[t]=M[t]:k[t]=I("Symbol."+t)),k[t]}var y=o("object"==typeof globalThis&&globalThis)||o("object"==typeof window&&window)||o("object"==typeof self&&self)||o("object"==typeof e&&e)||Function("return this")(),g=!i(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),m=y.document,b=c(m)&&c(m.createElement),w=!g&&!i(function(){return 7!=Object.defineProperty(u("div"),"a",{get:function(){return 7}}).a}),j=Object.defineProperty,S={f:g?j:function(t,e,n){if(h(t),e=f(e,!0),h(n),w)try{return j(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},O=g?function(t,e,n){return S.f(t,e,s(1,n))}:function(t,e,n){return t[e]=n,t},E="__core-js_shared__",T=y[E]||l(E,{}),A=n(function(t){(t.exports=function(t,e){return T[t]||(T[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.6.5",mode:"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})}),_={}.hasOwnProperty,D=0,x=Math.random(),P=!!Object.getOwnPropertySymbols&&!i(function(){return!String(Symbol())}),R=P&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,k=A("wks"),M=y.Symbol,I=R?M:M&&M.withoutSetter||d,C={};C[v("toStringTag")]="z";var N="[object z]"===String(C),K=Function.toString;"function"!=typeof T.inspectSource&&(T.inspectSource=function(t){return K.call(t)});var L,F,q,G,z,Y,B,W,J,U=T.inspectSource,V=y.WeakMap,H="function"==typeof V&&/native code/.test(U(V)),Q=A("keys"),X={},Z=y.WeakMap;B=H?(L=new Z,F=L.get,q=L.has,G=L.set,z=function(t,e){return G.call(L,t,e),e},Y=function(t){return F.call(L,t)||{}},function(t){return q.call(L,t)}):(W=Q[J="state"]||(Q[J]=d(J)),X[W]=!0,z=function(t,e){return O(t,W,e),e},Y=function(t){return p(t,W)?t[W]:{}},function(t){return p(t,W)});function $(t){return nt.call(t).slice(8,-1)}var tt={set:z,get:Y,has:B,enforce:function(t){return B(t)?Y(t):z(t,{})},getterFor:function(n){return function(t){var e;if(!c(t)||(e=Y(t)).type!==n)throw TypeError("Incompatible receiver, "+n+" required");return e}}},et=n(function(t){var e=tt.get,u=tt.enforce,a=String(String).split("String");(t.exports=function(t,e,n,r){var o=!!r&&!!r.unsafe,i=!!r&&!!r.enumerable,c=!!r&&!!r.noTargetGet;"function"==typeof n&&("string"!=typeof e||p(n,"name")||O(n,"name",e),u(n).source=a.join("string"==typeof e?e:"")),t!==y?(o?!c&&t[e]&&(i=!0):delete t[e],i?t[e]=n:O(t,e,n)):i?t[e]=n:l(e,n)})(Function.prototype,"toString",function(){return"function"==typeof this&&e(this).source||U(this)})}),nt={}.toString,rt=v("toStringTag"),ot="Arguments"==$(function(){return arguments}()),it=N?$:function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),rt))?n:ot?$(e):"Object"==(r=$(e))&&"function"==typeof e.callee?"Arguments":r},ct=N?{}.toString:function(){return"[object "+it(this)+"]"};N||et(Object.prototype,"toString",ct,{unsafe:!0});function ut(t){return jt(function(t){if(null==t)throw TypeError("Can't call method on "+t);return t}(t))}function at(t){return"function"==typeof t?t:void 0}function ft(t,e){return arguments.length<2?at(Et[t])||at(y[t]):Et[t]&&Et[t][e]||y[t]&&y[t][e]}function st(t){return isNaN(t=+t)?0:(0<t?At:Tt)(t)}function lt(t){return 0<t?_t(st(t),9007199254740991):0}function pt(f){return function(t,e,n){var r,o,i,c=ut(t),u=lt(c.length),a=(r=u,(o=st(n))<0?Dt(o+r,0):xt(o,r));if(f&&e!=e){for(;a<u;)if((i=c[a++])!=i)return!0}else for(;a<u;a++)if((f||a in c)&&c[a]===e)return f||a||0;return!f&&-1}}function dt(t,e){var n=Kt[Nt(t)];return n==Ft||n!=Lt&&("function"==typeof e?i(e):!!e)}function vt(t,e){var n,r,o,i,c=t.target,u=t.global,a=t.stat,f=u?y:a?y[c]||l(c,{}):(y[c]||{}).prototype;if(f)for(n in e){if(o=e[n],r=t.noTargetGet?(i=Gt(f,n))&&i.value:f[n],!qt(u?n:c+(a?".":"#")+n,t.forced)&&void 0!==r){if(typeof o==typeof r)continue;!function(t,e){for(var n=It(e),r=S.f,o=Ot.f,i=0;i<n.length;i++){var c=n[i];p(t,c)||r(t,c,o(e,c))}}(o,r)}(t.sham||r&&r.sham)&&O(o,"sham",!0),et(f,n,o,t)}}function ht(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t}function yt(r,o,t){if(ht(r),void 0===o)return r;switch(t){case 0:return function(){return r.call(o)};case 1:return function(t){return r.call(o,t)};case 2:return function(t,e){return r.call(o,t,e)};case 3:return function(t,e,n){return r.call(o,t,e,n)}}return function(){return r.apply(o,arguments)}}var gt={}.propertyIsEnumerable,mt=Object.getOwnPropertyDescriptor,bt={f:mt&&!gt.call({1:2},1)?function(t){var e=mt(this,t);return!!e&&e.enumerable}:gt},wt="".split,jt=i(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return"String"==$(t)?wt.call(t,""):Object(t)}:Object,St=Object.getOwnPropertyDescriptor,Ot={f:g?St:function(t,e){if(t=ut(t),e=f(e,!0),w)try{return St(t,e)}catch(t){}if(p(t,e))return s(!bt.f.call(t,e),t[e])}},Et=y,Tt=Math.ceil,At=Math.floor,_t=Math.min,Dt=Math.max,xt=Math.min,Pt={includes:pt(!0),indexOf:pt(!1)}.indexOf,Rt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"].concat("length","prototype"),kt={f:Object.getOwnPropertyNames||function(t){return function(t,e){var n,r=ut(t),o=0,i=[];for(n in r)!p(X,n)&&p(r,n)&&i.push(n);for(;e.length>o;)p(r,n=e[o++])&&(~Pt(i,n)||i.push(n));return i}(t,Rt)}},Mt={f:Object.getOwnPropertySymbols},It=ft("Reflect","ownKeys")||function(t){var e=kt.f(h(t)),n=Mt.f;return n?e.concat(n(t)):e},Ct=/#|\.prototype\./,Nt=dt.normalize=function(t){return String(t).replace(Ct,".").toLowerCase()},Kt=dt.data={},Lt=dt.NATIVE="N",Ft=dt.POLYFILL="P",qt=dt,Gt=Ot.f,zt=y.Promise,Yt=S.f,Bt=v("toStringTag"),Wt=v("species"),Jt={},Ut=v("iterator"),Vt=Array.prototype,Ht=v("iterator"),Qt=n(function(t){function v(t,e){this.stopped=t,this.result=e}(t.exports=function(t,e,n,r,o){var i,c,u,a,f,s,l,p,d=yt(e,n,r?2:1);if(o)i=t;else{if("function"!=typeof(c=function(t){if(null!=t)return t[Ht]||t["@@iterator"]||Jt[it(t)]}(t)))throw TypeError("Target is not iterable");if(void 0!==(p=c)&&(Jt.Array===p||Vt[Ut]===p)){for(u=0,a=lt(t.length);u<a;u++)if((f=r?d(h(l=t[u])[0],l[1]):d(t[u]))&&f instanceof v)return f;return new v(!1)}i=c.call(t)}for(s=i.next;!(l=s.call(i)).done;)if("object"==typeof(f=function(e,t,n,r){try{return r?t(h(n)[0],n[1]):t(n)}catch(t){var o=e.return;throw void 0!==o&&h(o.call(e)),t}}(i,d,l.value,r))&&f&&f instanceof v)return f;return new v(!1)}).stop=function(t){return new v(!0,t)}}),Xt=v("iterator"),Zt=!1;try{var $t=0,te={next:function(){return{done:!!$t++}},return:function(){Zt=!0}};te[Xt]=function(){return this},Array.from(te,function(){throw 2})}catch(t){}function ee(t){var e;be.hasOwnProperty(t)&&(e=be[t],delete be[t],e())}function ne(t){return function(){ee(t)}}function re(t){ee(t.data)}function oe(t){y.postMessage(t+"",pe.protocol+"//"+pe.host)}var ie,ce,ue,ae=v("species"),fe=ft("document","documentElement"),se=ft("navigator","userAgent")||"",le=/(iphone|ipod|ipad).*applewebkit/i.test(se),pe=y.location,de=y.setImmediate,ve=y.clearImmediate,he=y.process,ye=y.MessageChannel,ge=y.Dispatch,me=0,be={},we="onreadystatechange";de&&ve||(de=function(t){for(var e=[],n=1;n<arguments.length;)e.push(arguments[n++]);return be[++me]=function(){("function"==typeof t?t:Function(t)).apply(void 0,e)},ie(me),me},ve=function(t){delete be[t]},"process"==$(he)?ie=function(t){he.nextTick(ne(t))}:ge&&ge.now?ie=function(t){ge.now(ne(t))}:ye&&!le?(ue=(ce=new ye).port2,ce.port1.onmessage=re,ie=yt(ue.postMessage,ue,1)):!y.addEventListener||"function"!=typeof postMessage||y.importScripts||i(oe)||"file:"===pe.protocol?ie=we in u("script")?function(t){fe.appendChild(u("script"))[we]=function(){fe.removeChild(this),ee(t)}}:function(t){setTimeout(ne(t),0)}:(ie=oe,y.addEventListener("message",re,!1)));var je,Se,Oe,Ee,Te,Ae,_e,De,xe={set:de,clear:ve},Pe=Ot.f,Re=xe.set,ke=y.MutationObserver||y.WebKitMutationObserver,Me=y.process,Ie=y.Promise,Ce="process"==$(Me),Ne=Pe(y,"queueMicrotask"),Ke=Ne&&Ne.value;Ke||(je=function(){var t,e;for(Ce&&(t=Me.domain)&&t.exit();Se;){e=Se.fn,Se=Se.next;try{e()}catch(t){throw Se?Ee():Oe=void 0,t}}Oe=void 0,t&&t.enter()},Ee=Ce?function(){Me.nextTick(je)}:ke&&!le?(Te=!0,Ae=document.createTextNode(""),new ke(je).observe(Ae,{characterData:!0}),function(){Ae.data=Te=!Te}):Ie&&Ie.resolve?(_e=Ie.resolve(void 0),De=_e.then,function(){De.call(_e,je)}):function(){Re.call(y,je)});function Le(t){var n,r;this.promise=new t(function(t,e){if(void 0!==n||void 0!==r)throw TypeError("Bad Promise constructor");n=t,r=e}),this.resolve=ht(n),this.reject=ht(r)}function Fe(t,e){if(h(t),c(e)&&e.constructor===t)return e;var n=Be.f(t);return(0,n.resolve)(e),n.promise}function qe(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}}var Ge,ze,Ye=Ke||function(t){var e={fn:t,next:void 0};Oe&&(Oe.next=e),Se||(Se=e,Ee()),Oe=e},Be={f:function(t){return new Le(t)}},We=y.process,Je=We&&We.versions,Ue=Je&&Je.v8;Ue?ze=(Ge=Ue.split("."))[0]+Ge[1]:se&&(!(Ge=se.match(/Edge\/(\d+)/))||74<=Ge[1])&&(Ge=se.match(/Chrome\/(\d+)/))&&(ze=Ge[1]);function Ve(t){var e;return!(!c(t)||"function"!=typeof(e=t.then))&&e}function He(l,p,d){var v;p.notified||(p.notified=!0,v=p.reactions,Ye(function(){for(var t=p.value,e=1==p.state,n=0;v.length>n;){var r,o,i,c=v[n++],u=e?c.ok:c.fail,a=c.resolve,f=c.reject,s=c.domain;try{u?(e||(2===p.rejection&&Pn(l,p),p.rejection=1),!0===u?r=t:(s&&s.enter(),r=u(t),s&&(s.exit(),i=!0)),r===c.promise?f(gn("Promise-chain cycle")):(o=Ve(r))?o.call(r,a,f):a(r)):f(t)}catch(t){s&&!i&&s.exit(),f(t)}}p.reactions=[],p.notified=!1,d&&!p.rejection&&Dn(l,p)}))}function Qe(t,e,n){var r,o;En?((r=mn.createEvent("Event")).promise=e,r.reason=n,r.initEvent(t,!1,!0),y.dispatchEvent(r)):r={promise:e,reason:n},(o=y["on"+t])?o(r):t===Tn&&function(t,e){var n=y.console;n&&n.error&&(1===arguments.length?n.error(t):n.error(t,e))}("Unhandled promise rejection",n)}function Xe(e,n,r,o){return function(t){e(n,r,t,o)}}function Ze(t,e,n,r){e.done||(e.done=!0,r&&(e=r),e.value=n,e.state=2,He(t,e,!0))}var $e,tn,en,nn,rn,on,cn,un,an,fn=ze&&+ze,sn=xe.set,ln=v("species"),pn="Promise",dn=tt.get,vn=tt.set,hn=tt.getterFor(pn),yn=zt,gn=y.TypeError,mn=y.document,bn=y.process,wn=ft("fetch"),jn=Be.f,Sn=jn,On="process"==$(bn),En=!!(mn&&mn.createEvent&&y.dispatchEvent),Tn="unhandledrejection",An=qt(pn,function(){if(!(U(yn)!==String(yn))){if(66===fn)return!0;if(!On&&"function"!=typeof PromiseRejectionEvent)return!0}if(51<=fn&&/native code/.test(yn))return!1;function t(t){t(function(){},function(){})}var e=yn.resolve(1);return(e.constructor={})[ln]=t,!(e.then(function(){})instanceof t)}),_n=An||!function(t,e){if(!e&&!Zt)return!1;var n=!1;try{var r={};r[Xt]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch(t){}return n}(function(t){yn.all(t).catch(function(){})}),Dn=function(n,r){sn.call(y,function(){var t,e=r.value;if(xn(r)&&(t=qe(function(){On?bn.emit("unhandledRejection",e,n):Qe(Tn,n,e)}),r.rejection=On||xn(r)?2:1,t.error))throw t.value})},xn=function(t){return 1!==t.rejection&&!t.parent},Pn=function(t,e){sn.call(y,function(){On?bn.emit("rejectionHandled",t):Qe("rejectionhandled",t,e.value)})},Rn=function(n,r,t,e){if(!r.done){r.done=!0,e&&(r=e);try{if(n===t)throw gn("Promise can't be resolved itself");var o=Ve(t);o?Ye(function(){var e={done:!1};try{o.call(t,Xe(Rn,n,e,r),Xe(Ze,n,e,r))}catch(t){Ze(n,e,t,r)}}):(r.value=t,r.state=1,He(n,r,!1))}catch(t){Ze(n,{done:!1},t,r)}}};An&&(yn=function(t){!function(t,e,n){if(!(t instanceof e))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation")}(this,yn,pn),ht(t),$e.call(this);var e=dn(this);try{t(Xe(Rn,this,e),Xe(Ze,this,e))}catch(t){Ze(this,e,t)}},($e=function(){vn(this,{type:pn,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=function(t,e,n){for(var r in e)et(t,r,e[r],n);return t}(yn.prototype,{then:function(t,e){var n,r,o,i=hn(this),c=jn((n=yn,void 0===(o=h(this).constructor)||null==(r=h(o)[ae])?n:ht(r)));return c.ok="function"!=typeof t||t,c.fail="function"==typeof e&&e,c.domain=On?bn.domain:void 0,i.parent=!0,i.reactions.push(c),0!=i.state&&He(this,i,!1),c.promise},catch:function(t){return this.then(void 0,t)}}),tn=function(){var t=new $e,e=dn(t);this.promise=t,this.resolve=Xe(Rn,t,e),this.reject=Xe(Ze,t,e)},Be.f=jn=function(t){return t===yn||t===en?new tn:Sn(t)},"function"==typeof zt&&(nn=zt.prototype.then,et(zt.prototype,"then",function(t,e){var n=this;return new yn(function(t,e){nn.call(n,t,e)}).then(t,e)},{unsafe:!0}),"function"==typeof wn&&vt({global:!0,enumerable:!0,forced:!0},{fetch:function(t){return Fe(yn,wn.apply(y,arguments))}}))),vt({global:!0,wrap:!0,forced:An},{Promise:yn}),cn=!(on=pn),(rn=yn)&&!p(rn=cn?rn:rn.prototype,Bt)&&Yt(rn,Bt,{configurable:!0,value:on}),un=ft(pn),an=S.f,g&&un&&!un[Wt]&&an(un,Wt,{configurable:!0,get:function(){return this}}),en=ft(pn),vt({target:pn,stat:!0,forced:An},{reject:function(t){var e=jn(this);return e.reject.call(void 0,t),e.promise}}),vt({target:pn,stat:!0,forced:An},{resolve:function(t){return Fe(this,t)}}),vt({target:pn,stat:!0,forced:_n},{all:function(t){var u=this,e=jn(u),a=e.resolve,f=e.reject,n=qe(function(){var r=ht(u.resolve),o=[],i=0,c=1;Qt(t,function(t){var e=i++,n=!1;o.push(void 0),c++,r.call(u,t).then(function(t){n||(n=!0,o[e]=t,--c||a(o))},f)}),--c||a(o)});return n.error&&f(n.value),e.promise},race:function(t){var n=this,r=jn(n),o=r.reject,e=qe(function(){var e=ht(n.resolve);Qt(t,function(t){e.call(n,t).then(r.resolve,o)})});return e.error&&o(e.value),r.promise}});var kn="STORAGE_ORDER_DATA",Mn=function(){function r(){var n=this,t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];a(this,r);function e(){var t=window.indexedDB.open(kn,1);t.onsuccess=function(t){r.db=n.db=t.target.result},t.onerror=function(t){console.error("❌打开数据库",t)},t.onupgradeneeded=function(t){n.db=t.target.result,n.db,n.db.objectStoreNames.contains("ORDER_DATA")&&n.db.deleteObjectStore("ORDER_DATA");var e=n.db.createObjectStore("ORDER_DATA",{keyPath:"order_name"});e.createIndex("order_name","order_name",{unique:!1}),e.createIndex("order_value","order_value",{unique:!1})}}t?r.clearCache(e):e()}return t(r,[{key:"save",value:function(r,o){var i=this;return new Promise(function(e,n){var t=i.db.transaction(["ORDER_DATA"],"readwrite").objectStore("ORDER_DATA").put({order_name:r,order_value:o});t.onsuccess=function(t){e(t)},t.onerror=function(t){console.error("数据写入失败",t),n(t)}})}},{key:"remove",value:function(r){var o=this;return new Promise(function(e,n){var t=o.db.transaction(["ORDER_DATA"],"readwrite").objectStore("ORDER_DATA").delete(r);t.onsuccess=function(t){e(t)},t.onerror=function(t){console.error("删除数据失败",t),n(t)}})}},{key:"get",value:function(t){var o=this;return new Promise(function(e,n){var r=o.db.transaction(["ORDER_DATA"],"readonly").objectStore("ORDER_DATA").index("order_name").get(t);r.onerror=function(t){console.error("❌获取数据失败",t),n(t)},r.onsuccess=function(t){e(r.result)}})}}],[{key:"clearCache",value:function(e,n){var t;null==this||null!==(t=this.db)&&void 0!==t&&t.close();var r=window.indexedDB.deleteDatabase(kn);r.onerror=function(t){n&&n(t)},r.onsuccess=function(t){e&&e(t)}}}]),r}(),In=function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=e.storageKey,r=void 0===n?"StorageIdbMessageOrder":n,o=e.clearIdb,i=void 0===o||o,c=e.force,u=void 0!==c&&c;a(this,t),this.storageKey=r,this.clearIdb=i,this.force=u};return function(){function c(t){var r=this;a(this,c);var e=new In(t),n=e.storageKey,o=e.clearIdb,i=e.force;this.idb=new Mn(i),this.STORAGE_KEY=n,window.addEventListener("storage",function(t){var e;t.key===r.STORAGE_KEY&&(e=JSON.parse(t.newValue).order,r.idb.get(e).then(function(t){var e=t.order_name,n=t.order_value;r.response(e,n),o&&r.idb.remove(e)}))})}return t(c,[{key:"send",value:function(e,t){var n=this;this.idb.save(e,t).then(function(){var t=Math.random();localStorage.setItem(n.STORAGE_KEY,JSON.stringify({order:e,random:t}))})}},{key:"response",value:function(){}}],[{key:"clearCache",value:function(t,e){Mn.clearCache(t,e)}}]),c}()});
